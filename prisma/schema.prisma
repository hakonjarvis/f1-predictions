// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int               @id @default(autoincrement())
  authId     String?           @unique // <- kobles til Supabase user.id
  name       String
  email      String            @unique
  prediction SeasonPrediction?
  createdAt  DateTime          @default(now())
}

model Team {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  constructor String?
  drivers     Driver[]
}

model Driver {
  id                   Int                    @id @default(autoincrement())
  name                 String
  code                 String                 @unique
  number               Int?                   // Driver number (e.g., 1, 33, 44)
  country              String?
  headshotUrl          String?
  teamId               Int
  team                 Team                   @relation(fields: [teamId], references: [id])
  predictions          DriverPrediction[]
  results              RaceResult[]
  ChampionshipStanding ChampionshipStanding[]
}

model SeasonPrediction {
  id          Int                @id @default(autoincrement())
  userId      Int                @unique
  user        User               @relation(fields: [userId], references: [id])
  createdAt   DateTime           @default(now())
  predictions DriverPrediction[]
}

model DriverPrediction {
  id                 Int              @id @default(autoincrement())
  seasonPredictionId Int
  driverId           Int
  predictedPosition  Int
  seasonPrediction   SeasonPrediction @relation(fields: [seasonPredictionId], references: [id], onDelete: Cascade)
  driver             Driver           @relation(fields: [driverId], references: [id])
}

model RaceResult {
  id         Int      @id @default(autoincrement())
  raceName   String
  round      Int
  year       Int      @default(2025)
  sessionKey Int?                    // OpenF1 session identifier
  driverId   Int
  position   Int
  points     Int
  driver     Driver   @relation(fields: [driverId], references: [id])

  @@unique([sessionKey, driverId])  // Prevent duplicate results for same session/driver
}

model ChampionshipStanding {
  id        Int      @id @default(autoincrement())
  driverId  Int
  points    Int
  position  Int
  updatedAt DateTime @default(now())
  driver    Driver   @relation(fields: [driverId], references: [id])
}
